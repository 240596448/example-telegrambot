stages:
  - deploy
 
deploy:
  stage: deploy
  script:
  - grep '%ver' -P -R -I -l ./src/packagedef | xargs sed -i 's/%ver/'$CI_COMMIT_REF_NAME'/g'
  - rm .gitignore
  - mkdir -p ./src/oscript_modules/telegrambot/
  - cd ./src/oscript_modules/telegrambot/
  - git clone https://github.com/pallid/telegrambot.git
  - cd .
  - git remote add heroku https://heroku:$HEROKU_API_KEY@git.heroku.com/$HEROKU_APP_NAME.git
  - git push -f heroku master
  artifacts:
    when: on_failure
    paths:
    - .
    expire_in: 1 day
